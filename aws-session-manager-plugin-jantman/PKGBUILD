# Generated by debtap
# Maintainer: Jason Antman <jason@jasonantman.com>
# Contributor: Jason Antman <jason@jasonantman.com>
# Original Maintainer: Callum Denby <me@callumdenby.com>
# Original Contributor: Callum Denby <me@callumdenby.com>
pkgname=aws-session-manager-plugin-jantman
pkgver=1.1.54.0
pkgrel=1
pkgdesc="AWS Session Manager Plugin for aws-cli."
arch=('i686' 'x86_64')
url="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html"
license=('custom')
# remove depends, since I install aws-cli via pip
#depends=('aws-cli')
backup=('usr/lib/systemd/system/session-manager-plugin.service' 'usr/sessionmanagerplugin/LICENSE' 'usr/sessionmanagerplugin/seelog.xml' 'usr/sessionmanagerplugin/VERSION')
options=('!strip' '!emptydirs')
source_i686=(https://s3.amazonaws.com/session-manager-downloads/plugin/${pkgver}/ubuntu_32bit/session-manager-plugin.deb)
source_x86_64=(https://s3.amazonaws.com/session-manager-downloads/plugin/${pkgver}/ubuntu_64bit/session-manager-plugin.deb)
sha512sums_i686=('30a57826533ecd15028ff562f6ed6137196c8198e0321bed54c9fe7d4a1d8c7832e4baa757dff3cda39992379b111b754f3ff1e2804862f792e421c68b664c7f')
sha512sums_x86_64=('5a6956fd45a8c8d51bcf02084cdd9fad8f86e1467891058a5b2396a0971b1f591c5495d2788bd57d006bbac7bcf6431f57131820eadab79b0eb8eb5be015b15d')

package(){

	# Extract package data
	tar xzf data.tar.gz -C "${pkgdir}"

	# Fix directories structure differencies
	cd "${pkgdir}"

	mkdir -p usr/bin
	mkdir -p usr/lib 2> /dev/null; mv lib/* usr/lib; rm -rf lib

	rm -fr etc/

	sed -i 's/usr\/local/usr/' usr/lib/systemd/system/session-manager-plugin.service

	mv usr/local/* usr; rm -rf usr/local

	ln -sf /usr/sessionmanagerplugin/bin/session-manager-plugin usr/bin/session-manager-plugin

	cd ..
}
